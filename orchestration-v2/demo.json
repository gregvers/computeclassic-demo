{
  "description": "Demo of Oracle Compute Classic",
  "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/demo-orchestration",
  "desired_state": "active",
  "objects": [
    {
      "type": "SSHKey",
      "label": "demo-ssh",
      "template": {
        "enabled": false,
        "key": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDV0j0L1w+Mwhu+rw/f8kWFlbfi1Jq2yXxSQlrLAnBrE/kjmCj8c8JNwKuwu52AOf/Guc+jaaYgb5T9bC0+DAQ/GbpxNHHnTaWAWVOyLcbKkZqbPnBtAF+LpcG2UBdyP6fOxeB5MJKmleA+5XkYTd3lrmE55VYmSM3V86toV6ALdwqw2daH+L7+QCx9Vu9UlDvgjJr+TdcT24hBrHegWnS0JNfuFiBTgkiJ07NnpgNQdRSjxpw5nCW/aMYr/2WAxze0jtxG7f3neofErHEVAaFAh+0u/bYEB3HiMtA6WqChQcEiKDv2iOppdbez6acViOaXBZS6qdUtOD3ldJ6A3ZxP",
        "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/demo-ssh"
       }
    },
    {
       "type": "IpNetworkExchange",
       "label": "demo-IPX",
       "template": {
         "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/demo-IPX"
        }
      },
    {
       "type": "IpNetwork",
       "label": "external-network",
       "description": "external-network",
       "template": {
         "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/external-network",
         "ipAddressPrefix": "192.168.0.0/24"
       }
    },
    {
       "type": "IpNetwork",
       "label": "jumphost-network",
       "template": {
         "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/jumphost-network",
         "ipAddressPrefix": "192.168.1.0/24",
         "ipNetworkExchange": "{{demo-IPX:name}}"
       }
    },
    {
      "type": "IpAddressReservation",
      "label": "jumphost-ip",
      "template": {
        "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/jumphost-ip",
        "ipAddressPool": "/oracle/public/ippool"
      }
    },
    {
      "label": "ssh",
      "type": "SecurityProtocol",
      "template": {
        "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/ssh",
        "ipProtocol": "tcp",
        "dstPortSet": ["22"]
      }
    },
    {
      "label": "icmp",
      "type": "SecurityProtocol",
      "template": {
        "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/icmp",
        "ipProtocol": "icmp"
      }
    },
    {
      "label": "jumphost-ext-vnicset",
      "type": "VirtualNicSet",
      "template": {
        "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/jumphost-ext-vnicset",
        "appliedAcls": ["{{jumphost-ext-acl:name}}"]
      }
    },    {
      "label": "jumphost-int-vnicset",
      "type": "VirtualNicSet",
      "template": {
        "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/jumphost-int-vnicset",
        "appliedAcls": ["{{jumphost-int-acl:name}}"]
      }
    },
    {
      "label": "jumphost-ext-acl",
      "type": "Acl",
      "template": {
        "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/jumphost-ext-acl"
      }
    },
    {
      "label": "jumphost-int-acl",
      "type": "Acl",
      "template": {
        "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/jumphost-int-acl"
      }
    },
    {
     "label": "jumphost-from-anywhere",
     "type": "SecurityRule",
     "template":
     {
       "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/jumphost-from-anywhere",
       "acl": "{{jumphost-ext-acl:name}}",
       "flowDirection": "ingress",
       "secProtocols": ["{{ssh:name}}"]
      }
    },
    {
     "label": "jumphost-to-anywhere",
     "type": "SecurityRule",
     "template":
     {
       "name": "/Compute-orcdevtest1/gregory.verstraeten@oracle.com/jumphost-to-anywhere",
       "acl": "{{jumphost-int-acl:name}}",
       "flowDirection": "egress",
       "secProtocols": ["{{ssh:name}}"]
      }
    },
    {
      "type": "Instance",
      "label": "jumphost",
      "template": {
        "label": "jumphost",
        "hostname": "jumphost",
        "shape": "oc3",
        "imagelist": "/oracle/public/OL_7.2_UEKR4_x86_64",
        "networking": {
          "eth0": {
            "ipnetwork" : "{{external-network:name}}",
            "vnicsets": ["{{jumphost-ext-vnicset:name}}"],
            "is_default_gateway": true
          },
          "eth1": {
            "ipnetwork" : "{{jumphost-network:name}}",
            "vnicsets": ["{{jumphost-int-vnicset:name}}"],
            "nat": ["network/v1/ipreservation:{{jumphost-ip:name}}"],
            "dns": ["jumphost"]
          }
        },
        "sshkeys": [ "{{demo-ssh:name}}" ],
        "attributes": {
            "userdata": {
              "pre-bootstrap": {
                "script": [
                  "sed -i 's/enabled=1/enabled=0/' /etc/yum.repos.d/ksplice-uptrack.repo",
                  "echo 'proxy=http://proxy:3128' >> /etc/yum.conf",
                  "cd /tmp",
                  "until curl --proxy http://proxy:3128 -O https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm; do sleep 10; done",
                  "yum install -y ./epel-release-latest-7.noarch.rpm"
                ]
              }
            }
          }
        }
      }
  ],
  "tags": ["computeclassic-demo"]
}
